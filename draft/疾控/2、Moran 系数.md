---
title: cdc Moran‘s I
post: false
---



# Moran's I 系数

空间自相关的基本度量是空间自相关系数, 其指标有很多, 较为常见的空间自相关的指标有 Moran's I 系数、 Geary‘s C 系数等。目前 Moran's l 系数是研究空间自相关最为经典且应用最为广泛的方法。 Moran's I 统计量在公共卫生领域也得到了广泛的应用。 Morans l 系数是由 Moran 于 1948 年提出的,它反映的是空间邻接或邻近的区域单位属性值的相似程度, 用来衡量相邻的空间分布对象的属性取值之间的关系, 包括全局 Moran's l 系数和局部 Moran's l 系数, 分别度量全局空间自相关 ( Global Spatial Autocorrelation ) 和局部空间自相关 ( Local Spatial  Autocorrelation )。



( 1 ) Moran’s Ⅰ 系数的计算与检验
全局空间自相关分析方法主要在于通过描述某些个属性变量在整体空间上分布状况, 判定该属性在整个地理空间中是否存在聚集性的特点,而全局 Moran's Ⅰ 系数可对该特点进行度量, 其公式如下:
$$
I_{global} = \frac{n \sum_{i=1}^n \sum_{j=1}^n w_{ij} (x_i-\bar x)}
									{\sum_{i=1}^n \sum_{j=1}^n w_{ij} \sum_{i=1}^n(x_i-\bar x)^2}
\tag{3}
$$
式中, $$ n $$ 表示观察属性值的数目;  $ x_i $ 与 $ x_j $ 是在单元格 i 与 j 处的观察值, $\bar x$ 为所有空间单元属性值的均值, $ w_{ij} $ 表示空间权重矩阵。$ I $ 值的结果介于 -1 到 1 之间: 

$ I $ 值大于零表示研究对象之间存在空间正相关, 呈聚集性分布, 数值越接近 1 , 正相关程度越强; 

$ I $ 值小于零表示研究对象之间存在空间负相关, 呈离散性分布, 数值越接近 -1, 负相关程度越强; 

$ I  $ 值等于零表示研究对象在地理空间分布上为随机分布。



全局空间自相关无法确定具体的聚集区,只能在整体上说明空间对象是否存在自相关, 若想得知某一区域与周围区域之间的关系, 我们可以通过局部空间自相关实现, 同时计算局部 Moran's Ⅰ 系数对其度量, 其公式如下:
$$
I_{local} = \frac{n^2(x_i - \bar x) \sum_{j=1}^n w_{ij} (x_j - \bar x))}
								 {\sum_{i=1}^n(x_i - \bar x)^2}
\tag{4}
$$
式中字母表示与全局 Moran's Ⅰ 系数相同。

$$ I $$ 大于零表示区域 i 与周围其它区域呈局部空间正相关, 我们称之为空间聚集, 包括两种空间关系:

   ① 区域 i 为高属性值, 且被同是高属性值的区域所包围的空间关系, 呈现高 - 高 ( High - High ) 关联;

   ② 区域 i 为低属性值, 且被同是低属性值的区域所包围的空间关系,呈现低 - 低 ( Low - Low )关联。

$$ I $$ 小于零表示区域 i 与周围其它区域呈局部空间负相关, 我们称之为异常点或离群值, 包含两种空间关系:

   ① 区域 i 为高属性值, 且被低属性值的区域所包围的空间关系, 呈现高 - 低 ( High - Low ) 关联;

   ② 区域 i 为低属性值, 且被高属性值的区域所包围的空间关系, 呈现低 - 高 ( Low - High ) 关联。

$$ I $$ 等于零表示区域 i 与周围其它区域不存在局部空间自相关。



在进行空间自相关分析时, 为确保在一定概率下推断结论的正确性, 显著性检验是必不可少的, 我们可以采用 Z-score 对 Moran‘s 系数进行显著性检验, 其公式如下 :
$$
Z(I) = \frac{I - E(I)}{\sqrt{V(I)}}
\tag{5}
$$
式中, Z( I ) 表示 Moran's I 系数的显著水平, E(I) 为在零假设条件下, 即研究对象之间没有任何空间相关性, Moran's l 系数的期望值, V( I ) 为 Moran's I 系数的方差。在 α = 0.05 的检验水准下, 当|Z| > 1.96 时, 拒绝零假设, 说明研究对象的属性值存在空间自相关。



[扩展阅读：Moran‘s I 计算](https://en.wikipedia.org/wiki/Moran%27s_I)

[扩展阅读：Moran's I 的 z 得分计算](https://pro.arcgis.com/zh-cn/pro-app/tool-reference/spatial-statistics/h-how-spatial-autocorrelation-moran-s-i-spatial-st.htm)
$$
Z_I = \frac{I - E[I]}{\sqrt{V[I]}} \\
$$
其中：
$$
E[I] = -1 / (n - 1) \\
V[I] = E[I^2] + E[I]^2
$$
然后：
$$
\begin{align*}
& E[I^2] = \frac{A-B}{C} \\
& A = n[(n^2-3n+3)S_1-nS_2+3S_0^2] \\
& B = D[(n^2-n)S_1-2nS_2+6S_0^2] \\
& C = (n-1)(n-2)(n-3)S_0^2 \\
& D = \frac{\sum_{i=1}^nZ_i^4}{(\sum_{i=1}^nZ_i^2)^2} \\

& S_0 = \sum_{i=1}^n\sum_{j=1}^n w_{i,j} \\
& S_1 = (1/2) \sum_{i=1}^n \sum_{j=1}^n(w_{i,j} + w_{j,i})^2 \\
& S_2 = \sum_{i=1}^n(\sum_{j=1}^n w_{i,j} + \sum_{j=1}^n w_{j,i})^2 \\
& Z_i = x_i - \bar x
\end{align*}
$$
[扩展阅读：零假设](https://blog.csdn.net/allenlu2008/article/details/47950451) 

零假设可以理解为瞎猜的概率，拒绝零假设证明没有瞎猜。在相关性检验中，一般会取“两者之间无关联”作为零假设。

[扩展阅读：P 值和 Z 得分](https://blog.csdn.net/allenlu2008/article/details/47171915)

p值（P-Value，Probability，Pr），代表的是概率。它是反映某一事件发生的可能性大小。在空间相关性的分析中，p值表示所观测到的空间模式是由某一随机过程创建而成的概率。比如我说，你计算出来的 p 值是 1，那就表示你用于计算的这份数据，100% 是随机生成的了（当然，不可能是1的，0.5以上就也不得了）。如果是 0.1，就表示只有 10% 的可能性是随机生成的结果。

这样看来，p值是越小越好，但是小到什么样的程度才会最好呢？后面我们会就这个问题继续讨论。

z 得分（z-scores）表示标准差的倍数（standard deviations）。

先看看“标准差”是什么，在官方的解释是：“总体各单位标准值与其平均数离差平方的算术平均数的平方根”，好吧，我知道这个概念有点绕口，你就知道记住“标准差能反映一个数据集的离散程度”，就可以了。

那么 **z** 得分，就是标准差的倍数（ 有正负之分 ），比如 **z** 得分是 **+2.5**，就表示你的数据计算出来，得到的结果是标准差的正 **2.5** 倍。反之，如果你算出来的是 **-2.5** , 那么就表示你的结果是标准差的负 **2.5** 倍。

| **\|z\| 得分（标准差）** | **p 值（概率）** | **置信度** |
| ------------------------ | ---------------- | ---------- |
| > 1.65                   | < 0.10           | 90%        |
| > 1.96                   | < 0.05           | 95%        |
| > 2.58                   | < 0.01           | 99%        |

1、**莫兰指数**是正数，而且大于**0.7**，就表示这份数据具有空间正相关性，数据集的用于分析的值与空间聚集度成正比。

2、**p** 值小于 **0.05** ，所以本数据是随机生成的概率只有**5%**（**95%**的置信度）。

3、**z** 得分大于**1.96** ，说明这份数据的呈现了明显的聚类特征。

[扩展阅读：P 值的计算](https://zhuanlan.zhihu.com/p/42803826)

过程： 计算chi-suqare(卡方值)，计算自由度，查卡方分布表

卡方值计算：
$$
X^2 = \sum \frac{(A-T)^2}{T}
\tag{7}
$$
自由度计算：
$$
V = (行数 - 1) * (列数 - 1)
\tag{8}
$$


卡方分布表：

| 自由度k / P值 | 0.95  | 0.90 | 0.80 | 0.70 | 0.50 | 0.30  | 0.20  | 0.10  | 0.05  | 0.01  | 0.001 |
| :-----------: | :---- | ---- | ---- | ---- | ---- | ----- | ----- | ----- | ----- | ----- | ----- |
|       1       | 0.004 | 0.02 | 0.06 | 0.15 | 0.46 | 1.07  | 1.64  | 2.71  | 3.84  | 6.64  | 10.83 |
|       2       | 0.10  | 0.21 | 0.45 | 0.71 | 1.39 | 2.41  | 3.22  | 4.60  | 5.99  | 9.21  | 13.82 |
|       3       | 0.35  | 0.58 | 1.01 | 1.42 | 2.37 | 3.66  | 4.64  | 6.25  | 7.82  | 11.34 | 16.27 |
|       4       | 0.71  | 1.06 | 1.65 | 2.20 | 3.36 | 4.88  | 5.99  | 7.78  | 9.49  | 13.28 | 18.47 |
|       5       | 1.14  | 1.61 | 2.34 | 3.00 | 4.35 | 6.06  | 7.29  | 9.24  | 11.07 | 15.09 | 20.52 |
|       6       | 1.63  | 2.20 | 3.07 | 3.83 | 5.35 | 7.23  | 8.56  | 10.64 | 12.59 | 16.81 | 22.46 |
|       7       | 2.17  | 2.83 | 3.82 | 4.67 | 6.35 | 8.38  | 9.80  | 12.02 | 14.07 | 18.48 | 24.32 |
|       8       | 2.73  | 3.49 | 4.59 | 5.53 | 7.34 | 9.52  | 11.03 | 13.36 | 15.51 | 20.09 | 26.12 |
|       9       | 3.32  | 4.17 | 5.38 | 6.39 | 8.34 | 10.66 | 12.24 | 14.68 | 16.92 | 21.67 | 27.88 |
|      10       | 3.94  | 4.86 | 6.18 | 7.27 | 9.34 | 11.78 | 13.44 | 15.99 | 18.31 | 23.21 | 29.59 |

